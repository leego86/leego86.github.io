---
title: 缓存穿透、缓存击穿和缓存雪崩
date: 2019-04-11 22:31:33
tags: 缓存 cache
categories: cache
---

# 1 缓存穿透

如果缓存不命中会到db上查询数据再加载到缓存中，以备后面的请求直接从缓存查询数据，减小db的压力，但是如果db中也不存在的数据，请求每次都会过缓存层，直接访问的db，造成db压力激增，如果恶意攻击的话可能造成db宕机。
    
简单的办法是db中没有值就再缓存中存储null，这样请求就不会穿透缓存直接打到db上。但是如果有大量的key都是存储的空值，对于缓存资源来说也是一种浪费。
    
另一种方法就是在缓存层之前加一个布隆过滤层，过滤器认为存在的key才访问缓存或db，就能直接减少缓存层的资源浪费

# 2 缓存击穿

高并发场景下，如果一个访问量很大的key过期了，同一时间会有大量的请求访问db，就是缓存击穿，也会对db造成压力激增。
    
解决办法是在读取db重新加载缓存的代码上增加互斥锁，避免大量的请求打到db上

# 3 缓存雪崩

高并发场景下，如果某一时刻有大量的key过期或缓存层整个宕机，造成很大量请求直接访问到db，造成db宕机，  这种就称为缓存雪崩。
    
这种情况下首先需要保证缓存的高可用，比如redis的cluster主从或sentinel集群。
    
其次，缓存的过期时间最好使用随机数作为系数，错开缓存的失效时间，避免大量的key同时失效，从而避免缓存雪崩情况
